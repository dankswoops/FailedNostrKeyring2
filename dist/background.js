var eo=Object.defineProperty;var to=(e,t,n)=>t in e?eo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $e=(e,t,n)=>to(e,typeof t!="symbol"?t+"":t,n);function wn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function kn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function no(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");wn(e.outputLen),wn(e.blockLen)}function Je(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ro(e,t){kn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const wt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Rn=e=>e instanceof Uint8Array,bt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Q=(e,t)=>e<<32-t|e>>>t,oo=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!oo)throw new Error("Non little-endian hardware is not supported");function io(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function qt(e){if(typeof e=="string"&&(e=io(e)),!Rn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function so(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!Rn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Cn=class{clone(){return this._cloneInto()}};function ao(e){const t=r=>e().update(qt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Hn(e=32){if(wt&&typeof wt.getRandomValues=="function")return wt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function co(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+f,c,r)}let fo=class extends Cn{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=bt(this.buffer)}update(t){Je(this);const{view:n,buffer:r,blockLen:o}=this;t=qt(t);const i=t.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=bt(t);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Je(this),ro(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;co(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=bt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],i)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return t.length=o,t.pos=c,t.finished=i,t.destroyed=s,o%n&&t.buffer.set(r),t}};const lo=(e,t,n)=>e&t^~e&n,uo=(e,t,n)=>e&t^e&n^t&n,ho=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),he=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ge=new Uint32Array(64);let go=class extends fo{constructor(){super(64,32,8,!1),this.A=he[0]|0,this.B=he[1]|0,this.C=he[2]|0,this.D=he[3]|0,this.E=he[4]|0,this.F=he[5]|0,this.G=he[6]|0,this.H=he[7]|0}get(){const{A:t,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[t,n,r,o,i,s,c,a]}set(t,n,r,o,i,s,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)ge[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const h=ge[l-15],b=ge[l-2],w=Q(h,7)^Q(h,18)^h>>>3,d=Q(b,17)^Q(b,19)^b>>>10;ge[l]=d+ge[l-7]+w+ge[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){const h=Q(c,6)^Q(c,11)^Q(c,25),b=u+h+lo(c,a,f)+ho[l]+ge[l]|0,d=(Q(r,2)^Q(r,13)^Q(r,22))+uo(r,o,i)|0;u=f,f=a,a=c,c=s+b|0,s=i,i=o,o=r,r=b+d|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,i,s,c,a,f,u)}roundClean(){ge.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const _t=ao(()=>new go);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const On=BigInt(0),nt=BigInt(1),po=BigInt(2),rt=e=>e instanceof Uint8Array,yo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Re(e){if(!rt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=yo[e[n]];return t}function Pn(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function Dt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Ce(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,i=e.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function F(e){return Dt(Re(e))}function jt(e){if(!rt(e))throw new Error("Uint8Array expected");return Dt(Re(Uint8Array.from(e).reverse()))}function Ee(e,t){return Ce(e.toString(16).padStart(t*2,"0"))}function zt(e,t){return Ee(e,t).reverse()}function wo(e){return Ce(Pn(e))}function V(e,t,n){let r;if(typeof t=="string")try{r=Ce(t)}catch(i){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${i}`)}else if(rt(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function Be(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!rt(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function bo(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Eo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function xo(e){let t;for(t=0;e>On;e>>=nt,t+=1);return t}function mo(e,t){return e>>BigInt(t)&nt}const vo=(e,t,n)=>e|(n?nt:On)<<BigInt(t),Vt=e=>(po<<BigInt(e-1))-nt,Et=e=>new Uint8Array(e),bn=e=>Uint8Array.from(e);function Mn(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Et(e),o=Et(e),i=0;const s=()=>{r.fill(1),o.fill(0),i=0},c=(...l)=>n(o,r,...l),a=(l=Et())=>{o=c(bn([0]),l),r=c(),l.length!==0&&(o=c(bn([1]),l),r=c())},f=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<t;){r=c();const b=r.slice();h.push(b),l+=r.length}return Be(...h)};return(l,h)=>{s(),a(l);let b;for(;!(b=h(f()));)a();return s(),b}}const Ao={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Ve(e,t,n={}){const r=(o,i,s)=>{const c=Ao[i];if(typeof c!="function")throw new Error(`Invalid validator "${i}", expected function`);const a=e[o];if(!(s&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${i}`)};for(const[o,i]of Object.entries(t))r(o,i,!1);for(const[o,i]of Object.entries(n))r(o,i,!0);return e}const So=Object.freeze(Object.defineProperty({__proto__:null,bitGet:mo,bitLen:xo,bitMask:Vt,bitSet:vo,bytesToHex:Re,bytesToNumberBE:F,bytesToNumberLE:jt,concatBytes:Be,createHmacDrbg:Mn,ensureBytes:V,equalBytes:bo,hexToBytes:Ce,hexToNumber:Dt,numberToBytesBE:Ee,numberToBytesLE:zt,numberToHexUnpadded:Pn,numberToVarBytesBE:wo,utf8ToBytes:Eo,validateObject:Ve},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const j=BigInt(0),K=BigInt(1),Ae=BigInt(2),Bo=BigInt(3),Lt=BigInt(4),En=BigInt(5),xn=BigInt(8);BigInt(9);BigInt(16);function z(e,t){const n=e%t;return n>=j?n:t+n}function Io(e,t,n){if(n<=j||t<j)throw new Error("Expected power/modulo > 0");if(n===K)return j;let r=K;for(;t>j;)t&K&&(r=r*e%n),e=e*e%n,t>>=K;return r}function W(e,t,n){let r=e;for(;t-- >j;)r*=r,r%=n;return r}function $t(e,t){if(e===j||t<=j)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=z(e,t),r=t,o=j,i=K;for(;n!==j;){const c=r/n,a=r%n,f=o-i*c;r=n,n=a,o=i,i=f}if(r!==K)throw new Error("invert: does not exist");return z(o,t)}function No(e){const t=(e-K)/Ae;let n,r,o;for(n=e-K,r=0;n%Ae===j;n/=Ae,r++);for(o=Ae;o<e&&Io(o,t,e)!==e-K;o++);if(r===1){const s=(e+K)/Lt;return function(a,f){const u=a.pow(f,s);if(!a.eql(a.sqr(u),f))throw new Error("Cannot find square root");return u}}const i=(n+K)/Ae;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let f=r,u=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,i),h=c.pow(a,n);for(;!c.eql(h,c.ONE);){if(c.eql(h,c.ZERO))return c.ZERO;let b=1;for(let d=c.sqr(h);b<f&&!c.eql(d,c.ONE);b++)d=c.sqr(d);const w=c.pow(u,K<<BigInt(f-b-1));u=c.sqr(w),l=c.mul(l,w),h=c.mul(h,u),f=b}return l}}function _o(e){if(e%Lt===Bo){const t=(e+K)/Lt;return function(r,o){const i=r.pow(o,t);if(!r.eql(r.sqr(i),o))throw new Error("Cannot find square root");return i}}if(e%xn===En){const t=(e-En)/xn;return function(r,o){const i=r.mul(o,Ae),s=r.pow(i,t),c=r.mul(o,s),a=r.mul(r.mul(c,Ae),s),f=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(f),o))throw new Error("Cannot find square root");return f}}return No(e)}const Lo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function $o(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=Lo.reduce((r,o)=>(r[o]="function",r),t);return Ve(e,n)}function Uo(e,t,n){if(n<j)throw new Error("Expected power > 0");if(n===j)return e.ONE;if(n===K)return t;let r=e.ONE,o=t;for(;n>j;)n&K&&(r=e.mul(r,o)),o=e.sqr(o),n>>=K;return r}function To(e,t){const n=new Array(t.length),r=t.reduce((i,s,c)=>e.is0(s)?i:(n[c]=i,e.mul(i,s)),e.ONE),o=e.inv(r);return t.reduceRight((i,s,c)=>e.is0(s)?i:(n[c]=e.mul(i,n[c]),e.mul(i,s)),o),n}function Kn(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function ko(e,t,n=!1,r={}){if(e<=j)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:i}=Kn(e,t);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=_o(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:i,MASK:Vt(o),ZERO:j,ONE:K,create:a=>z(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return j<=a&&a<e},is0:a=>a===j,isOdd:a=>(a&K)===K,neg:a=>z(-a,e),eql:(a,f)=>a===f,sqr:a=>z(a*a,e),add:(a,f)=>z(a+f,e),sub:(a,f)=>z(a-f,e),mul:(a,f)=>z(a*f,e),pow:(a,f)=>Uo(c,a,f),div:(a,f)=>z(a*$t(f,e),e),sqrN:a=>a*a,addN:(a,f)=>a+f,subN:(a,f)=>a-f,mulN:(a,f)=>a*f,inv:a=>$t(a,e),sqrt:r.sqrt||(a=>s(c,a)),invertBatch:a=>To(c,a),cmov:(a,f,u)=>u?f:a,toBytes:a=>n?zt(a,i):Ee(a,i),fromBytes:a=>{if(a.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${a.length}`);return n?jt(a):F(a)}});return Object.freeze(c)}function qn(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Dn(e){const t=qn(e);return t+Math.ceil(t/2)}function Ro(e,t,n=!1){const r=e.length,o=qn(t),i=Dn(t);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const s=n?F(e):jt(e),c=z(s,t-K)+K;return n?zt(c,o):Ee(c,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Co=BigInt(0),xt=BigInt(1);function Ho(e,t){const n=(o,i)=>{const s=i.negate();return o?s:i},r=o=>{const i=Math.ceil(t/o)+1,s=2**(o-1);return{windows:i,windowSize:s}};return{constTimeNegate:n,unsafeLadder(o,i){let s=e.ZERO,c=o;for(;i>Co;)i&xt&&(s=s.add(c)),c=c.double(),i>>=xt;return s},precomputeWindow(o,i){const{windows:s,windowSize:c}=r(i),a=[];let f=o,u=f;for(let l=0;l<s;l++){u=f,a.push(u);for(let h=1;h<c;h++)u=u.add(f),a.push(u);f=u.double()}return a},wNAF(o,i,s){const{windows:c,windowSize:a}=r(o);let f=e.ZERO,u=e.BASE;const l=BigInt(2**o-1),h=2**o,b=BigInt(o);for(let w=0;w<c;w++){const d=w*a;let g=Number(s&l);s>>=b,g>a&&(g-=h,s+=xt);const p=d,m=d+Math.abs(g)-1,B=w%2!==0,U=g<0;g===0?u=u.add(n(B,i[p])):f=f.add(n(U,i[m]))}return{p:f,f:u}},wNAFCached(o,i,s,c){const a=o._WINDOW_SIZE||1;let f=i.get(o);return f||(f=this.precomputeWindow(o,a),a!==1&&i.set(o,c(f))),this.wNAF(a,f,s)}}}function jn(e){return $o(e.Fp),Ve(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Kn(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Oo(e){const t=jn(e);Ve(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:Po,hexToBytes:Mo}=So,Se={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=Se;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Po(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Se,n=typeof e=="string"?Mo(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:i}=Se._parseInt(n.subarray(2)),{d:s,l:c}=Se._parseInt(i);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s}},hexFromSig(e){const t=f=>Number.parseInt(f[0],16)&8?"00"+f:f,n=f=>{const u=f.toString(16);return u.length&1?`0${u}`:u},r=t(n(e.s)),o=t(n(e.r)),i=r.length/2,s=o.length/2,c=n(i),a=n(s);return`30${n(s+i+4)}02${a}${o}02${c}${r}`}},ie=BigInt(0),G=BigInt(1);BigInt(2);const mn=BigInt(3);BigInt(4);function Ko(e){const t=Oo(e),{Fp:n}=t,r=t.toBytes||((w,d,g)=>{const p=d.toAffine();return Be(Uint8Array.from([4]),n.toBytes(p.x),n.toBytes(p.y))}),o=t.fromBytes||(w=>{const d=w.subarray(1),g=n.fromBytes(d.subarray(0,n.BYTES)),p=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:g,y:p}});function i(w){const{a:d,b:g}=t,p=n.sqr(w),m=n.mul(p,w);return n.add(n.add(m,n.mul(w,d)),g)}if(!n.eql(n.sqr(t.Gy),i(t.Gx)))throw new Error("bad generator point: equation left != right");function s(w){return typeof w=="bigint"&&ie<w&&w<t.n}function c(w){if(!s(w))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(w){const{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:p,n:m}=t;if(d&&typeof w!="bigint"){if(w instanceof Uint8Array&&(w=Re(w)),typeof w!="string"||!d.includes(w.length))throw new Error("Invalid key");w=w.padStart(g*2,"0")}let B;try{B=typeof w=="bigint"?w:F(V("private key",w,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof w}`)}return p&&(B=z(B,m)),c(B),B}const f=new Map;function u(w){if(!(w instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,g,p){if(this.px=d,this.py=g,this.pz=p,d==null||!n.isValid(d))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(p==null||!n.isValid(p))throw new Error("z required")}static fromAffine(d){const{x:g,y:p}=d||{};if(!d||!n.isValid(g)||!n.isValid(p))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");const m=B=>n.eql(B,n.ZERO);return m(g)&&m(p)?l.ZERO:new l(g,p,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const g=n.invertBatch(d.map(p=>p.pz));return d.map((p,m)=>p.toAffine(g[m])).map(l.fromAffine)}static fromHex(d){const g=l.fromAffine(o(V("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return l.BASE.multiply(a(d))}_setWindowSize(d){this._WINDOW_SIZE=d,f.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:g}=this.toAffine();if(!n.isValid(d)||!n.isValid(g))throw new Error("bad point: x or y not FE");const p=n.sqr(g),m=i(d);if(!n.eql(p,m))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){u(d);const{px:g,py:p,pz:m}=this,{px:B,py:U,pz:_}=d,x=n.eql(n.mul(g,_),n.mul(B,m)),v=n.eql(n.mul(p,_),n.mul(U,m));return x&&v}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:g}=t,p=n.mul(g,mn),{px:m,py:B,pz:U}=this;let _=n.ZERO,x=n.ZERO,v=n.ZERO,A=n.mul(m,m),P=n.mul(B,B),$=n.mul(U,U),I=n.mul(m,B);return I=n.add(I,I),v=n.mul(m,U),v=n.add(v,v),_=n.mul(d,v),x=n.mul(p,$),x=n.add(_,x),_=n.sub(P,x),x=n.add(P,x),x=n.mul(_,x),_=n.mul(I,_),v=n.mul(p,v),$=n.mul(d,$),I=n.sub(A,$),I=n.mul(d,I),I=n.add(I,v),v=n.add(A,A),A=n.add(v,A),A=n.add(A,$),A=n.mul(A,I),x=n.add(x,A),$=n.mul(B,U),$=n.add($,$),A=n.mul($,I),_=n.sub(_,A),v=n.mul($,P),v=n.add(v,v),v=n.add(v,v),new l(_,x,v)}add(d){u(d);const{px:g,py:p,pz:m}=this,{px:B,py:U,pz:_}=d;let x=n.ZERO,v=n.ZERO,A=n.ZERO;const P=t.a,$=n.mul(t.b,mn);let I=n.mul(g,B),C=n.mul(p,U),H=n.mul(m,_),M=n.add(g,p),y=n.add(B,U);M=n.mul(M,y),y=n.add(I,C),M=n.sub(M,y),y=n.add(g,m);let E=n.add(B,_);return y=n.mul(y,E),E=n.add(I,H),y=n.sub(y,E),E=n.add(p,m),x=n.add(U,_),E=n.mul(E,x),x=n.add(C,H),E=n.sub(E,x),A=n.mul(P,y),x=n.mul($,H),A=n.add(x,A),x=n.sub(C,A),A=n.add(C,A),v=n.mul(x,A),C=n.add(I,I),C=n.add(C,I),H=n.mul(P,H),y=n.mul($,y),C=n.add(C,H),H=n.sub(I,H),H=n.mul(P,H),y=n.add(y,H),I=n.mul(C,y),v=n.add(v,I),I=n.mul(E,y),x=n.mul(M,x),x=n.sub(x,I),I=n.mul(M,C),A=n.mul(E,A),A=n.add(A,I),new l(x,v,A)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return b.wNAFCached(this,f,d,g=>{const p=n.invertBatch(g.map(m=>m.pz));return g.map((m,B)=>m.toAffine(p[B])).map(l.fromAffine)})}multiplyUnsafe(d){const g=l.ZERO;if(d===ie)return g;if(c(d),d===G)return this;const{endo:p}=t;if(!p)return b.unsafeLadder(this,d);let{k1neg:m,k1:B,k2neg:U,k2:_}=p.splitScalar(d),x=g,v=g,A=this;for(;B>ie||_>ie;)B&G&&(x=x.add(A)),_&G&&(v=v.add(A)),A=A.double(),B>>=G,_>>=G;return m&&(x=x.negate()),U&&(v=v.negate()),v=new l(n.mul(v.px,p.beta),v.py,v.pz),x.add(v)}multiply(d){c(d);let g=d,p,m;const{endo:B}=t;if(B){const{k1neg:U,k1:_,k2neg:x,k2:v}=B.splitScalar(g);let{p:A,f:P}=this.wNAF(_),{p:$,f:I}=this.wNAF(v);A=b.constTimeNegate(U,A),$=b.constTimeNegate(x,$),$=new l(n.mul($.px,B.beta),$.py,$.pz),p=A.add($),m=P.add(I)}else{const{p:U,f:_}=this.wNAF(g);p=U,m=_}return l.normalizeZ([p,m])[0]}multiplyAndAddUnsafe(d,g,p){const m=l.BASE,B=(_,x)=>x===ie||x===G||!_.equals(m)?_.multiplyUnsafe(x):_.multiply(x),U=B(this,g).add(B(d,p));return U.is0()?void 0:U}toAffine(d){const{px:g,py:p,pz:m}=this,B=this.is0();d==null&&(d=B?n.ONE:n.inv(m));const U=n.mul(g,d),_=n.mul(p,d),x=n.mul(m,d);if(B)return{x:n.ZERO,y:n.ZERO};if(!n.eql(x,n.ONE))throw new Error("invZ was invalid");return{x:U,y:_}}isTorsionFree(){const{h:d,isTorsionFree:g}=t;if(d===G)return!0;if(g)return g(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:g}=t;return d===G?this:g?g(l,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return this.assertValidity(),r(l,this,d)}toHex(d=!0){return Re(this.toRawBytes(d))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const h=t.nBitLength,b=Ho(l,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:i,isWithinCurveOrder:s}}function qo(e){const t=jn(e);return Ve(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function Do(e){const t=qo(e),{Fp:n,n:r}=t,o=n.BYTES+1,i=2*n.BYTES+1;function s(y){return ie<y&&y<n.ORDER}function c(y){return z(y,r)}function a(y){return $t(y,r)}const{ProjectivePoint:f,normPrivateKeyToScalar:u,weierstrassEquation:l,isWithinCurveOrder:h}=Ko({...t,toBytes(y,E,S){const L=E.toAffine(),N=n.toBytes(L.x),T=Be;return S?T(Uint8Array.from([E.hasEvenY()?2:3]),N):T(Uint8Array.from([4]),N,n.toBytes(L.y))},fromBytes(y){const E=y.length,S=y[0],L=y.subarray(1);if(E===o&&(S===2||S===3)){const N=F(L);if(!s(N))throw new Error("Point is not on curve");const T=l(N);let O=n.sqrt(T);const R=(O&G)===G;return(S&1)===1!==R&&(O=n.neg(O)),{x:N,y:O}}else if(E===i&&S===4){const N=n.fromBytes(L.subarray(0,n.BYTES)),T=n.fromBytes(L.subarray(n.BYTES,2*n.BYTES));return{x:N,y:T}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${i} uncompressed bytes`)}}),b=y=>Re(Ee(y,t.nByteLength));function w(y){const E=r>>G;return y>E}function d(y){return w(y)?c(-y):y}const g=(y,E,S)=>F(y.slice(E,S));class p{constructor(E,S,L){this.r=E,this.s=S,this.recovery=L,this.assertValidity()}static fromCompact(E){const S=t.nByteLength;return E=V("compactSignature",E,S*2),new p(g(E,0,S),g(E,S,2*S))}static fromDER(E){const{r:S,s:L}=Se.toSig(V("DER",E));return new p(S,L)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new p(this.r,this.s,E)}recoverPublicKey(E){const{r:S,s:L,recovery:N}=this,T=v(V("msgHash",E));if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");const O=N===2||N===3?S+t.n:S;if(O>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const R=N&1?"03":"02",Y=f.fromHex(R+b(O)),ue=a(O),Ie=c(-T*ue),qe=c(L*ue),de=f.BASE.multiplyAndAddUnsafe(Y,Ie,qe);if(!de)throw new Error("point at infinify");return de.assertValidity(),de}hasHighS(){return w(this.s)}normalizeS(){return this.hasHighS()?new p(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ce(this.toDERHex())}toDERHex(){return Se.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ce(this.toCompactHex())}toCompactHex(){return b(this.r)+b(this.s)}}const m={isValidPrivateKey(y){try{return u(y),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const y=Dn(t.n);return Ro(t.randomBytes(y),t.n)},precompute(y=8,E=f.BASE){return E._setWindowSize(y),E.multiply(BigInt(3)),E}};function B(y,E=!0){return f.fromPrivateKey(y).toRawBytes(E)}function U(y){const E=y instanceof Uint8Array,S=typeof y=="string",L=(E||S)&&y.length;return E?L===o||L===i:S?L===2*o||L===2*i:y instanceof f}function _(y,E,S=!0){if(U(y))throw new Error("first arg must be private key");if(!U(E))throw new Error("second arg must be public key");return f.fromHex(E).multiply(u(y)).toRawBytes(S)}const x=t.bits2int||function(y){const E=F(y),S=y.length*8-t.nBitLength;return S>0?E>>BigInt(S):E},v=t.bits2int_modN||function(y){return c(x(y))},A=Vt(t.nBitLength);function P(y){if(typeof y!="bigint")throw new Error("bigint expected");if(!(ie<=y&&y<A))throw new Error(`bigint expected < 2^${t.nBitLength}`);return Ee(y,t.nByteLength)}function $(y,E,S=I){if(["recovered","canonical"].some(ve=>ve in S))throw new Error("sign() legacy options not supported");const{hash:L,randomBytes:N}=t;let{lowS:T,prehash:O,extraEntropy:R}=S;T==null&&(T=!0),y=V("msgHash",y),O&&(y=V("prehashed msgHash",L(y)));const Y=v(y),ue=u(E),Ie=[P(ue),P(Y)];if(R!=null){const ve=R===!0?N(n.BYTES):R;Ie.push(V("extraEntropy",ve))}const qe=Be(...Ie),de=Y;function yt(ve){const Ne=x(ve);if(!h(Ne))return;const gn=a(Ne),_e=f.BASE.multiply(Ne).toAffine(),J=c(_e.x);if(J===ie)return;const Le=c(gn*c(de+J*ue));if(Le===ie)return;let pn=(_e.x===J?0:2)|Number(_e.y&G),yn=Le;return T&&w(Le)&&(yn=d(Le),pn^=1),new p(J,yn,pn)}return{seed:qe,k2sig:yt}}const I={lowS:t.lowS,prehash:!1},C={lowS:t.lowS,prehash:!1};function H(y,E,S=I){const{seed:L,k2sig:N}=$(y,E,S),T=t;return Mn(T.hash.outputLen,T.nByteLength,T.hmac)(L,N)}f.BASE._setWindowSize(8);function M(y,E,S,L=C){var _e;const N=y;if(E=V("msgHash",E),S=V("publicKey",S),"strict"in L)throw new Error("options.strict was renamed to lowS");const{lowS:T,prehash:O}=L;let R,Y;try{if(typeof N=="string"||N instanceof Uint8Array)try{R=p.fromDER(N)}catch(J){if(!(J instanceof Se.Err))throw J;R=p.fromCompact(N)}else if(typeof N=="object"&&typeof N.r=="bigint"&&typeof N.s=="bigint"){const{r:J,s:Le}=N;R=new p(J,Le)}else throw new Error("PARSE");Y=f.fromHex(S)}catch(J){if(J.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(T&&R.hasHighS())return!1;O&&(E=t.hash(E));const{r:ue,s:Ie}=R,qe=v(E),de=a(Ie),yt=c(qe*de),ve=c(ue*de),Ne=(_e=f.BASE.multiplyAndAddUnsafe(Y,yt,ve))==null?void 0:_e.toAffine();return Ne?c(Ne.x)===ue:!1}return{CURVE:t,getPublicKey:B,getSharedSecret:_,sign:H,verify:M,ProjectivePoint:f,Signature:p,utils:m}}let zn=class extends Cn{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,no(t);const r=qt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?t.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=t.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(t){return Je(this),this.iHash.update(t),this}digestInto(t){Je(this),kn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=i,t.blockLen=s,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Vn=(e,t,n)=>new zn(e,t).update(n).digest();Vn.create=(e,t)=>new zn(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function jo(e){return{hash:e,hmac:(t,...n)=>Vn(e,t,so(...n)),randomBytes:Hn}}function zo(e,t){const n=r=>Do({...e,...jo(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ot=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Xe=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Zn=BigInt(1),Qe=BigInt(2),vn=(e,t)=>(e+t/Qe)/t;function Fn(e){const t=ot,n=BigInt(3),r=BigInt(6),o=BigInt(11),i=BigInt(22),s=BigInt(23),c=BigInt(44),a=BigInt(88),f=e*e*e%t,u=f*f*e%t,l=W(u,n,t)*u%t,h=W(l,n,t)*u%t,b=W(h,Qe,t)*f%t,w=W(b,o,t)*b%t,d=W(w,i,t)*w%t,g=W(d,c,t)*d%t,p=W(g,a,t)*g%t,m=W(p,c,t)*d%t,B=W(m,n,t)*u%t,U=W(B,s,t)*w%t,_=W(U,r,t)*f%t,x=W(_,Qe,t);if(!Ut.eql(Ut.sqr(x),e))throw new Error("Cannot find square root");return x}const Ut=ko(ot,void 0,void 0,{sqrt:Fn}),Pe=zo({a:BigInt(0),b:BigInt(7),Fp:Ut,n:Xe,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Xe,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Zn*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,s=BigInt("0x100000000000000000000000000000000"),c=vn(i*e,t),a=vn(-r*e,t);let f=z(e-c*n-a*o,t),u=z(-c*r-a*i,t);const l=f>s,h=u>s;if(l&&(f=t-f),h&&(u=t-u),f>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:f,k2neg:h,k2:u}}}},_t),it=BigInt(0),Wn=e=>typeof e=="bigint"&&it<e&&e<ot,Vo=e=>typeof e=="bigint"&&it<e&&e<Xe,An={};function et(e,...t){let n=An[e];if(n===void 0){const r=_t(Uint8Array.from(e,o=>o.charCodeAt(0)));n=Be(r,r),An[e]=n}return _t(Be(n,...t))}const Zt=e=>e.toRawBytes(!0).slice(1),Tt=e=>Ee(e,32),mt=e=>z(e,ot),je=e=>z(e,Xe),Ft=Pe.ProjectivePoint,Zo=(e,t,n)=>Ft.BASE.multiplyAndAddUnsafe(e,t,n);function kt(e){let t=Pe.utils.normPrivateKeyToScalar(e),n=Ft.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:je(-t),bytes:Zt(n)}}function Gn(e){if(!Wn(e))throw new Error("bad x: need 0 < x < p");const t=mt(e*e),n=mt(t*e+BigInt(7));let r=Fn(n);r%Qe!==it&&(r=mt(-r));const o=new Ft(e,r,Zn);return o.assertValidity(),o}function Yn(...e){return je(F(et("BIP0340/challenge",...e)))}function Fo(e){return kt(e).bytes}function Wo(e,t,n=Hn(32)){const r=V("message",e),{bytes:o,scalar:i}=kt(t),s=V("auxRand",n,32),c=Tt(i^F(et("BIP0340/aux",s))),a=et("BIP0340/nonce",c,o,r),f=je(F(a));if(f===it)throw new Error("sign failed: k is zero");const{bytes:u,scalar:l}=kt(f),h=Yn(u,o,r),b=new Uint8Array(64);if(b.set(u,0),b.set(Tt(je(l+h*i)),32),!Jn(b,r,o))throw new Error("sign: Invalid signature produced");return b}function Jn(e,t,n){const r=V("signature",e,64),o=V("message",t),i=V("publicKey",n,32);try{const s=Gn(F(i)),c=F(r.subarray(0,32));if(!Wn(c))return!1;const a=F(r.subarray(32,64));if(!Vo(a))return!1;const f=Yn(Tt(c),Zt(s),o),u=Zo(s,a,je(-f));return!(!u||!u.hasEvenY()||u.toAffine().x!==c)}catch{return!1}}const te={getPublicKey:Fo,sign:Wo,verify:Jn,utils:{randomPrivateKey:Pe.utils.randomPrivateKey,lift_x:Gn,pointToBytes:Zt,numberToBytesBE:Ee,bytesToNumberBE:F,taggedHash:et,mod:z}},vt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Wt=e=>e instanceof Uint8Array,At=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ee=(e,t)=>e<<32-t|e>>>t,Go=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Go)throw new Error("Non little-endian hardware is not supported");const Yo=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function D(e){if(!Wt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Yo[e[n]];return t}function He(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,i=e.slice(o,o+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");n[r]=s}return n}function Jo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ze(e){if(typeof e=="string"&&(e=Jo(e)),!Wt(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function st(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!Wt(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class Xn{clone(){return this._cloneInto()}}function Qn(e){const t=r=>e().update(ze(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function er(e=32){if(vt&&typeof vt.getRandomValues=="function")return vt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Rt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Xo(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function tr(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Qo(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Rt(e.outputLen),Rt(e.blockLen)}function ei(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function ti(e,t){tr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const re={number:Rt,bool:Xo,bytes:tr,hash:Qo,exists:ei,output:ti};function ni(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),i=BigInt(4294967295),s=Number(n>>o&i),c=Number(n&i),a=r?4:0,f=r?0:4;e.setUint32(t+a,s,r),e.setUint32(t+f,c,r)}class ri extends Xn{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=At(this.buffer)}update(t){re.exists(this);const{view:n,buffer:r,blockLen:o}=this;t=ze(t);const i=t.length;for(let s=0;s<i;){const c=Math.min(o-this.pos,i-s);if(c===o){const a=At(t);for(;o<=i-s;s+=o)this.process(a,s);continue}r.set(t.subarray(s,s+c),this.pos),this.pos+=c,s+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){re.exists(this),re.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:i}=this;let{pos:s}=this;n[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>o-s&&(this.process(r,0),s=0);for(let l=s;l<o;l++)n[l]=0;ni(r,o-8,BigInt(this.length*8),i),this.process(r,0);const c=At(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const f=a/4,u=this.get();if(f>u.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<f;l++)c.setUint32(4*l,u[l],i)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:i,destroyed:s,pos:c}=this;return t.length=o,t.pos=c,t.finished=i,t.destroyed=s,o%n&&t.buffer.set(r),t}}const oi=(e,t,n)=>e&t^~e&n,ii=(e,t,n)=>e&t^e&n^t&n,si=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),pe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ye=new Uint32Array(64);class nr extends ri{constructor(){super(64,32,8,!1),this.A=pe[0]|0,this.B=pe[1]|0,this.C=pe[2]|0,this.D=pe[3]|0,this.E=pe[4]|0,this.F=pe[5]|0,this.G=pe[6]|0,this.H=pe[7]|0}get(){const{A:t,B:n,C:r,D:o,E:i,F:s,G:c,H:a}=this;return[t,n,r,o,i,s,c,a]}set(t,n,r,o,i,s,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=i|0,this.F=s|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)ye[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const h=ye[l-15],b=ye[l-2],w=ee(h,7)^ee(h,18)^h>>>3,d=ee(b,17)^ee(b,19)^b>>>10;ye[l]=d+ye[l-7]+w+ye[l-16]|0}let{A:r,B:o,C:i,D:s,E:c,F:a,G:f,H:u}=this;for(let l=0;l<64;l++){const h=ee(c,6)^ee(c,11)^ee(c,25),b=u+h+oi(c,a,f)+si[l]+ye[l]|0,d=(ee(r,2)^ee(r,13)^ee(r,22))+ii(r,o,i)|0;u=f,f=a,a=c,c=s+b|0,s=i,i=o,o=r,r=b+d|0}r=r+this.A|0,o=o+this.B|0,i=i+this.C|0,s=s+this.D|0,c=c+this.E|0,a=a+this.F|0,f=f+this.G|0,u=u+this.H|0,this.set(r,o,i,s,c,a,f,u)}roundClean(){ye.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class ai extends nr{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Me=Qn(()=>new nr);Qn(()=>new ai);var Ue=Symbol("verified"),ci=e=>e instanceof Object;function fi(e){if(!ci(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}new TextDecoder("utf-8");var li=new TextEncoder,ui=class{generateSecretKey(){return te.utils.randomPrivateKey()}getPublicKey(t){return D(te.getPublicKey(t))}finalizeEvent(t,n){const r=t;return r.pubkey=D(te.getPublicKey(n)),r.id=St(r),r.sig=D(te.sign(St(r),n)),r[Ue]=!0,r}verifyEvent(t){if(typeof t[Ue]=="boolean")return t[Ue];const n=St(t);if(n!==t.id)return t[Ue]=!1,!1;try{const r=te.verify(t.sig,n,t.pubkey);return t[Ue]=r,r}catch{return t[Ue]=!1,!1}}};function di(e){if(!fi(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function St(e){let t=Me(li.encode(di(e)));return D(t)}var at=new ui;at.generateSecretKey;at.getPublicKey;var hi=at.finalizeEvent;at.verifyEvent;/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ke(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function ce(...e){const t=(o,i)=>s=>o(i(s)),n=Array.from(e).reverse().reduce((o,i)=>o?t(o,i.encode):i.encode,void 0),r=e.reduce((o,i)=>o?t(o,i.decode):i.decode,void 0);return{encode:n,decode:r}}function fe(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Ke(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function le(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function ct(e,t="="){if(Ke(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function rr(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Sn(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],i=Array.from(e);for(i.forEach(s=>{if(Ke(s),s<0||s>=t)throw new Error(`Wrong integer: ${s}`)});;){let s=0,c=!0;for(let a=r;a<i.length;a++){const f=i[a],u=t*s+f;if(!Number.isSafeInteger(u)||t*s/t!==s||u-f!==t*s)throw new Error("convertRadix: carry overflow");if(s=u%n,i[a]=Math.floor(u/n),!Number.isSafeInteger(i[a])||i[a]*n+s!==u)throw new Error("convertRadix: carry overflow");if(c)i[a]?c=!1:r=a;else continue}if(o.push(s),c)break}for(let s=0;s<e.length-1&&e[s]===0;s++)o.push(0);return o.reverse()}const or=(e,t)=>t?or(t,e%t):e,tt=(e,t)=>e+(t-or(e,t));function Ct(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(tt(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${tt(t,n)}`);let o=0,i=0;const s=2**n-1,c=[];for(const a of e){if(Ke(a),a>=2**t)throw new Error(`convertRadix2: invalid data word=${a} from=${t}`);if(o=o<<t|a,i+t>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${t}`);for(i+=t;i>=n;i-=n)c.push((o>>i-n&s)>>>0);o&=2**i-1}if(o=o<<n-i&s,!r&&i>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&i>0&&c.push(o>>>0),c}function gi(e){return Ke(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Sn(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Sn(t,e,2**8))}}}function xe(e,t=!1){if(Ke(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(tt(8,e)>32||tt(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ct(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ct(n,e,8,t))}}}function Bn(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const pi=ce(xe(4),fe("0123456789ABCDEF"),le("")),yi=ce(xe(5),fe("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ct(5),le(""));ce(xe(5),fe("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ct(5),le(""));ce(xe(5),fe("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),le(""),rr(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const ae=ce(xe(6),fe("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ct(6),le("")),wi=ce(xe(6),fe("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ct(6),le("")),Gt=e=>ce(gi(58),fe(e),le("")),Ht=Gt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Gt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Gt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const In=[0,2,3,5,6,7,9,10,11],bi={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Ht.encode(r).padStart(In[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),o=In.indexOf(r.length),i=Ht.decode(r);for(let s=0;s<i.length-o;s++)if(i[s]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(i.slice(i.length-o)))}return Uint8Array.from(t)}},Ot=ce(fe("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),le("")),Nn=[996825010,642813549,513874426,1027748829,705979059];function De(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<Nn.length;r++)(t>>r&1)===1&&(n^=Nn[r]);return n}function _n(e,t,n=1){const r=e.length;let o=1;for(let i=0;i<r;i++){const s=e.charCodeAt(i);if(s<33||s>126)throw new Error(`Invalid prefix (${e})`);o=De(o)^s>>5}o=De(o);for(let i=0;i<r;i++)o=De(o)^e.charCodeAt(i)&31;for(let i of t)o=De(o)^i;for(let i=0;i<6;i++)o=De(o);return o^=n,Ot.encode(Ct([o%2**30],30,5,!1))}function ir(e){const t=e==="bech32"?1:734539939,n=xe(5),r=n.decode,o=n.encode,i=Bn(r);function s(u,l,h=90){if(typeof u!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof u}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);const b=u.length+7+l.length;if(h!==!1&&b>h)throw new TypeError(`Length ${b} exceeds limit ${h}`);return u=u.toLowerCase(),`${u}1${Ot.encode(l)}${_n(u,l,t)}`}function c(u,l=90){if(typeof u!="string")throw new Error(`bech32.decode input should be string, not ${typeof u}`);if(u.length<8||l!==!1&&u.length>l)throw new TypeError(`Wrong string length: ${u.length} (${u}). Expected (8..${l})`);const h=u.toLowerCase();if(u!==h&&u!==u.toUpperCase())throw new Error("String must be lowercase or uppercase");u=h;const b=u.lastIndexOf("1");if(b===0||b===-1)throw new Error('Letter "1" must be present between prefix and data only');const w=u.slice(0,b),d=u.slice(b+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const g=Ot.decode(d).slice(0,-6),p=_n(w,g,t);if(!d.endsWith(p))throw new Error(`Invalid checksum in ${u}: expected "${p}"`);return{prefix:w,words:g}}const a=Bn(c);function f(u){const{prefix:l,words:h}=c(u,!1);return{prefix:l,words:h,bytes:r(h)}}return{encode:s,decode:c,decodeToBytes:f,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:i,toWords:o}}const Oe=ir("bech32");ir("bech32m");const Ei={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},xi=ce(xe(4),fe("0123456789abcdef"),le(""),rr(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),mi={utf8:Ei,hex:xi,base16:pi,base32:yi,base64:ae,base64url:wi,base58:Ht,base58xmr:bi};`${Object.keys(mi).join(", ")}`;function Bt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Ln(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function vi(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function se(e,...t){if(!vi(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const Z=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Ai=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ai)throw new Error("Non little-endian hardware is not supported");function Si(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Bi(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const Ii=(e,t)=>(Object.assign(t,e),t),be=16,Ni=283;function Yt(e){return e<<1^Ni&-(e>>7)}function ke(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=Yt(e);return n}const Pt=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Yt(r))e[n]=r;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),_i=Pt.map((e,t)=>Pt.indexOf(t)),Li=e=>e<<24|e>>>8,It=e=>e<<8|e>>>24;function sr(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((f,u)=>t(e[u])),r=n.map(It),o=r.map(It),i=o.map(It),s=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let f=0;f<256;f++)for(let u=0;u<256;u++){const l=f*256+u;s[l]=n[f]^r[u],c[l]=o[f]^i[u],a[l]=e[f]<<8|e[u]}return{sbox:e,sbox2:a,T0:n,T1:r,T2:o,T3:i,T01:s,T23:c}}const Jt=sr(Pt,e=>ke(e,3)<<24|e<<16|e<<8|ke(e,2)),ar=sr(_i,e=>ke(e,11)<<24|ke(e,13)<<16|ke(e,9)<<8|ke(e,14)),$i=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=Yt(n))e[t]=n;return e})();function cr(e){se(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=Jt,r=Z(e),o=r.length,i=c=>oe(n,c,c,c,c),s=new Uint32Array(t+28);s.set(r);for(let c=o;c<s.length;c++){let a=s[c-1];c%o===0?a=i(Li(a))^$i[c/o-1]:o>6&&c%o===4&&(a=i(a)),s[c]=s[c-o]^a}return s}function Ui(e){const t=cr(e),n=t.slice(),r=t.length,{sbox2:o}=Jt,{T0:i,T1:s,T2:c,T3:a}=ar;for(let f=0;f<r;f+=4)for(let u=0;u<4;u++)n[f+u]=t[r-f-4+u];t.fill(0);for(let f=4;f<r-4;f++){const u=n[f],l=oe(o,u,u,u,u);n[f]=i[l&255]^s[l>>>8&255]^c[l>>>16&255]^a[l>>>24]}return n}function we(e,t,n,r,o,i){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|i>>>24&255]}function oe(e,t,n,r,o){return e[t&255|n&65280]|e[r>>>16&255|o>>>16&65280]<<16}function $n(e,t,n,r,o){const{sbox2:i,T01:s,T23:c}=Jt;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const f=e.length/4-2;for(let w=0;w<f;w++){const d=e[a++]^we(s,c,t,n,r,o),g=e[a++]^we(s,c,n,r,o,t),p=e[a++]^we(s,c,r,o,t,n),m=e[a++]^we(s,c,o,t,n,r);t=d,n=g,r=p,o=m}const u=e[a++]^oe(i,t,n,r,o),l=e[a++]^oe(i,n,r,o,t),h=e[a++]^oe(i,r,o,t,n),b=e[a++]^oe(i,o,t,n,r);return{s0:u,s1:l,s2:h,s3:b}}function Ti(e,t,n,r,o){const{sbox2:i,T01:s,T23:c}=ar;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const f=e.length/4-2;for(let w=0;w<f;w++){const d=e[a++]^we(s,c,t,o,r,n),g=e[a++]^we(s,c,n,t,o,r),p=e[a++]^we(s,c,r,n,t,o),m=e[a++]^we(s,c,o,r,n,t);t=d,n=g,r=p,o=m}const u=e[a++]^oe(i,t,o,r,n),l=e[a++]^oe(i,n,t,o,r),h=e[a++]^oe(i,r,n,t,o),b=e[a++]^oe(i,o,r,n,t);return{s0:u,s1:l,s2:h,s3:b}}function fr(e,t){if(!t)return new Uint8Array(e);if(se(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function ki(e){if(se(e),e.length%be!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${be}`)}function Ri(e,t,n){let r=e.length;const o=r%be;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const i=Z(e);if(t){let a=be-o;a||(a=be),r=r+a}const s=fr(r,n),c=Z(s);return{b:i,o:c,out:s}}function Ci(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=e.subarray(0,-r);for(let i=0;i<r;i++)if(e[n-i-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function Hi(e){const t=new Uint8Array(16),n=Z(t);t.set(e);const r=be-e.length;for(let o=be-r;o<be;o++)t[o]=r;return n}const lr=Ii({blockSize:16,nonceLength:16},function(t,n,r={}){se(t),se(n,16);const o=!r.disablePadding;return{encrypt:(i,s)=>{const c=cr(t),{b:a,o:f,out:u}=Ri(i,o,s),l=Z(n);let h=l[0],b=l[1],w=l[2],d=l[3],g=0;for(;g+4<=a.length;)h^=a[g+0],b^=a[g+1],w^=a[g+2],d^=a[g+3],{s0:h,s1:b,s2:w,s3:d}=$n(c,h,b,w,d),f[g++]=h,f[g++]=b,f[g++]=w,f[g++]=d;if(o){const p=Hi(i.subarray(g*4));h^=p[0],b^=p[1],w^=p[2],d^=p[3],{s0:h,s1:b,s2:w,s3:d}=$n(c,h,b,w,d),f[g++]=h,f[g++]=b,f[g++]=w,f[g++]=d}return c.fill(0),u},decrypt:(i,s)=>{ki(i);const c=Ui(t),a=Z(n),f=fr(i.length,s),u=Z(i),l=Z(f);let h=a[0],b=a[1],w=a[2],d=a[3];for(let g=0;g+4<=u.length;){const p=h,m=b,B=w,U=d;h=u[g+0],b=u[g+1],w=u[g+2],d=u[g+3];const{s0:_,s1:x,s2:v,s3:A}=Ti(c,h,b,w,d);l[g++]=_^p,l[g++]=x^m,l[g++]=v^B,l[g++]=A^U}return c.fill(0),Ci(f,o)}}}),ur=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),Oi=ur("expand 16-byte k"),Pi=ur("expand 32-byte k"),Mi=Z(Oi),dr=Z(Pi);dr.slice();function k(e,t){return e<<t|e>>>32-t}function Mt(e){return e.byteOffset%4===0}const We=64,Ki=16,hr=2**32-1,Un=new Uint32Array;function qi(e,t,n,r,o,i,s,c){const a=o.length,f=new Uint8Array(We),u=Z(f),l=Mt(o)&&Mt(i),h=l?Z(o):Un,b=l?Z(i):Un;for(let w=0;w<a;s++){if(e(t,n,r,u,s,c),s>=hr)throw new Error("arx: counter overflow");const d=Math.min(We,a-w);if(l&&d===We){const g=w/4;if(w%4!==0)throw new Error("arx: invalid block position");for(let p=0,m;p<Ki;p++)m=g+p,b[m]=h[m]^u[p];w+=We;continue}for(let g=0,p;g<d;g++)p=w+g,i[p]=o[p]^f[g];w+=d}}function Di(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:i,rounds:s}=Si({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Bt(o),Bt(s),Ln(i),Ln(n),(c,a,f,u,l=0)=>{se(c),se(a),se(f);const h=f.length;if(u||(u=new Uint8Array(h)),se(u),Bt(l),l<0||l>=hr)throw new Error("arx: counter overflow");if(u.length<h)throw new Error(`arx: output (${u.length}) is shorter than data (${h})`);const b=[];let w=c.length,d,g;if(w===32)d=c.slice(),b.push(d),g=dr;else if(w===16&&n)d=new Uint8Array(32),d.set(c),d.set(c,16),g=Mi,b.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${w}`);Mt(a)||(a=a.slice(),b.push(a));const p=Z(d);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,p,Z(a.subarray(0,16)),p),a=a.subarray(16)}const m=16-o;if(m!==a.length)throw new Error(`arx: nonce must be ${m} or 16 bytes`);if(m!==12){const U=new Uint8Array(12);U.set(a,i?0:12-a.length),a=U,b.push(a)}const B=Z(a);for(qi(e,g,p,B,f,u,l,s);b.length>0;)b.pop().fill(0);return u}}function ji(e,t,n,r,o,i=20){let s=e[0],c=e[1],a=e[2],f=e[3],u=t[0],l=t[1],h=t[2],b=t[3],w=t[4],d=t[5],g=t[6],p=t[7],m=o,B=n[0],U=n[1],_=n[2],x=s,v=c,A=a,P=f,$=u,I=l,C=h,H=b,M=w,y=d,E=g,S=p,L=m,N=B,T=U,O=_;for(let Y=0;Y<i;Y+=2)x=x+$|0,L=k(L^x,16),M=M+L|0,$=k($^M,12),x=x+$|0,L=k(L^x,8),M=M+L|0,$=k($^M,7),v=v+I|0,N=k(N^v,16),y=y+N|0,I=k(I^y,12),v=v+I|0,N=k(N^v,8),y=y+N|0,I=k(I^y,7),A=A+C|0,T=k(T^A,16),E=E+T|0,C=k(C^E,12),A=A+C|0,T=k(T^A,8),E=E+T|0,C=k(C^E,7),P=P+H|0,O=k(O^P,16),S=S+O|0,H=k(H^S,12),P=P+H|0,O=k(O^P,8),S=S+O|0,H=k(H^S,7),x=x+I|0,O=k(O^x,16),E=E+O|0,I=k(I^E,12),x=x+I|0,O=k(O^x,8),E=E+O|0,I=k(I^E,7),v=v+C|0,L=k(L^v,16),S=S+L|0,C=k(C^S,12),v=v+C|0,L=k(L^v,8),S=S+L|0,C=k(C^S,7),A=A+H|0,N=k(N^A,16),M=M+N|0,H=k(H^M,12),A=A+H|0,N=k(N^A,8),M=M+N|0,H=k(H^M,7),P=P+$|0,T=k(T^P,16),y=y+T|0,$=k($^y,12),P=P+$|0,T=k(T^P,8),y=y+T|0,$=k($^y,7);let R=0;r[R++]=s+x|0,r[R++]=c+v|0,r[R++]=a+A|0,r[R++]=f+P|0,r[R++]=u+$|0,r[R++]=l+I|0,r[R++]=h+C|0,r[R++]=b+H|0,r[R++]=w+M|0,r[R++]=d+y|0,r[R++]=g+E|0,r[R++]=p+S|0,r[R++]=m+L|0,r[R++]=B+N|0,r[R++]=U+T|0,r[R++]=_+O|0}const gr=Di(ji,{counterRight:!1,counterLength:4,allowShortKeys:!1});class pr extends Xn{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,re.hash(t);const r=ze(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,i=new Uint8Array(o);i.set(r.length>o?t.create().update(r).digest():r);for(let s=0;s<i.length;s++)i[s]^=54;this.iHash.update(i),this.oHash=t.create();for(let s=0;s<i.length;s++)i[s]^=106;this.oHash.update(i),i.fill(0)}update(t){return re.exists(this),this.iHash.update(t),this}digestInto(t){re.exists(this),re.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:i,blockLen:s,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=i,t.blockLen=s,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const ft=(e,t,n)=>new pr(e,t).update(n).digest();ft.create=(e,t)=>new pr(e,t);function zi(e,t,n){return re.hash(e),ft(e,ze(n),ze(t))}const Nt=new Uint8Array([0]),Tn=new Uint8Array;function Vi(e,t,n,r=32){if(re.hash(e),re.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);n===void 0&&(n=Tn);const i=new Uint8Array(o*e.outputLen),s=ft.create(e,t),c=s._cloneInto(),a=new Uint8Array(s.outputLen);for(let f=0;f<o;f++)Nt[0]=f+1,c.update(f===0?Tn:a).update(n).update(Nt).digestInto(a),i.set(a,e.outputLen*f),s._cloneInto(c);return s.destroy(),c.destroy(),a.fill(0),Nt.fill(0),i.slice(0,r)}var Zi=Object.defineProperty,q=(e,t)=>{for(var n in t)Zi(e,n,{get:t[n],enumerable:!0})},Te=Symbol("verified"),Fi=e=>e instanceof Object;function yr(e){if(!Fi(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var Wi={};q(Wi,{Queue:()=>Xi,QueueNode:()=>wr,binarySearch:()=>Xt,insertEventIntoAscendingList:()=>Ji,insertEventIntoDescendingList:()=>Yi,normalizeURL:()=>Gi,utf8Decoder:()=>ne,utf8Encoder:()=>X});var ne=new TextDecoder("utf-8"),X=new TextEncoder;function Gi(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function Yi(e,t){const[n,r]=Xt(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return r||e.splice(n,0,t),e}function Ji(e,t){const[n,r]=Xt(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return r||e.splice(n,0,t),e}function Xt(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),i=t(e[o]);if(i===0)return[o,!0];i<0?r=o-1:n=o+1}return[n,!1]}var wr=class{constructor(e){$e(this,"value");$e(this,"next",null);$e(this,"prev",null);this.value=e}},Xi=class{constructor(){$e(this,"first");$e(this,"last");this.first=null,this.last=null}enqueue(e){const t=new wr(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},Qi=class{generateSecretKey(){return te.utils.randomPrivateKey()}getPublicKey(e){return D(te.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=D(te.getPublicKey(t)),n.id=Ye(n),n.sig=D(te.sign(Ye(n),t)),n[Te]=!0,n}verifyEvent(e){if(typeof e[Te]=="boolean")return e[Te];const t=Ye(e);if(t!==e.id)return e[Te]=!1,!1;try{const n=te.verify(e.sig,t,e.pubkey);return e[Te]=n,n}catch{return e[Te]=!1,!1}}};function es(e){if(!yr(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Ye(e){let t=Me(X.encode(es(e)));return D(t)}var lt=new Qi;lt.generateSecretKey;lt.getPublicKey;var me=lt.finalizeEvent,Qt=lt.verifyEvent,ts={};q(ts,{Application:()=>ta,BadgeAward:()=>ls,BadgeDefinition:()=>Ws,BlockedRelaysList:()=>ks,BookmarkList:()=>$s,Bookmarksets:()=>Vs,Calendar:()=>ca,CalendarEventRSVP:()=>fa,ChannelCreation:()=>vr,ChannelHideMessage:()=>Br,ChannelMessage:()=>Sr,ChannelMetadata:()=>Ar,ChannelMuteUser:()=>Ir,ClassifiedListing:()=>oa,ClientAuth:()=>Nr,CommunitiesList:()=>Us,CommunityDefinition:()=>da,CommunityPostApproval:()=>Es,Contacts:()=>ss,CreateOrUpdateProduct:()=>Js,CreateOrUpdateStall:()=>Ys,Curationsets:()=>Zs,Date:()=>sa,DraftClassifiedListing:()=>ia,DraftLong:()=>Qs,Emojisets:()=>ea,EncryptedDirectMessage:()=>as,EncryptedDirectMessages:()=>cs,EventDeletion:()=>fs,FileMetadata:()=>hs,FileServerPreference:()=>Os,Followsets:()=>Ds,GenericRepost:()=>us,Genericlists:()=>js,HTTPAuth:()=>nn,Handlerinformation:()=>ua,Handlerrecommendation:()=>la,Highlights:()=>Is,InterestsList:()=>Cs,Interestsets:()=>Gs,JobFeedback:()=>vs,JobRequest:()=>xs,JobResult:()=>ms,Label:()=>bs,LightningPubRPC:()=>Ms,LiveChatMessage:()=>gs,LiveEvent:()=>na,LongFormArticle:()=>Xs,Metadata:()=>rs,Mutelist:()=>Ns,NWCWalletInfo:()=>Ps,NWCWalletRequest:()=>_r,NWCWalletResponse:()=>Ks,NostrConnect:()=>qs,OpenTimestamps:()=>ds,Pinlist:()=>_s,ProblemTracker:()=>ps,ProfileBadges:()=>Fs,PublicChatsList:()=>Ts,Reaction:()=>tn,RecommendRelay:()=>is,RelayList:()=>Ls,Relaysets:()=>zs,Report:()=>ys,Reporting:()=>ws,Repost:()=>en,SearchRelaysList:()=>Rs,ShortTextNote:()=>os,Time:()=>aa,UserEmojiList:()=>Hs,UserStatuses:()=>ra,Zap:()=>Bs,ZapGoal:()=>As,ZapRequest:()=>Ss,classifyKind:()=>ns,isEphemeralKind:()=>xr,isParameterizedReplaceableKind:()=>mr,isRegularKind:()=>br,isReplaceableKind:()=>Er});function br(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function Er(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function xr(e){return 2e4<=e&&e<3e4}function mr(e){return 3e4<=e&&e<4e4}function ns(e){return br(e)?"regular":Er(e)?"replaceable":xr(e)?"ephemeral":mr(e)?"parameterized":"unknown"}var rs=0,os=1,is=2,ss=3,as=4,cs=4,fs=5,en=6,tn=7,ls=8,us=16,vr=40,Ar=41,Sr=42,Br=43,Ir=44,ds=1040,hs=1063,gs=1311,ps=1971,ys=1984,ws=1984,bs=1985,Es=4550,xs=5999,ms=6999,vs=7e3,As=9041,Ss=9734,Bs=9735,Is=9802,Ns=1e4,_s=10001,Ls=10002,$s=10003,Us=10004,Ts=10005,ks=10006,Rs=10007,Cs=10015,Hs=10030,Os=10096,Ps=13194,Ms=21e3,Nr=22242,_r=23194,Ks=23195,qs=24133,nn=27235,Ds=3e4,js=30001,zs=30002,Vs=30003,Zs=30004,Fs=30008,Ws=30009,Gs=30015,Ys=30017,Js=30018,Xs=30023,Qs=30024,ea=30030,ta=30078,na=30311,ra=30315,oa=30402,ia=30403,sa=31922,aa=31923,ca=31924,fa=31925,la=31989,ua=31990,da=34550,ha={};q(ha,{getHex64:()=>rn,getInt:()=>Lr,getSubscriptionId:()=>ga,matchEventId:()=>pa,matchEventKind:()=>wa,matchEventPubkey:()=>ya});function rn(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function Lr(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,o=e.slice(r),i=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,i),10)}function ga(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let i=r+1+o;return e.slice(r+1,i)}function pa(e,t){return t===rn(e,"id")}function ya(e,t){return t===rn(e,"pubkey")}function wa(e,t){return t===Lr(e,"kind")}var ba={};q(ba,{makeAuthEvent:()=>Ea});function Ea(e,t){return{kind:Nr,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var xa;try{xa=WebSocket}catch{}var ma;try{ma=WebSocket}catch{}var va={};q(va,{BECH32_REGEX:()=>$r,Bech32MaxSize:()=>on,decode:()=>ut,encodeBytes:()=>dt,naddrEncode:()=>La,neventEncode:()=>_a,noteEncode:()=>Ia,nprofileEncode:()=>Na,npubEncode:()=>Ba,nrelayEncode:()=>$a,nsecEncode:()=>Sa});var on=5e3,$r=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Aa(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function ut(e){var o,i,s,c,a,f,u,l;let{prefix:t,words:n}=Oe.decode(e,on),r=new Uint8Array(Oe.fromWords(n));switch(t){case"nprofile":{let h=Ge(r);if(!((o=h[0])!=null&&o[0]))throw new Error("missing TLV 0 for nprofile");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:D(h[0][0]),relays:h[1]?h[1].map(b=>ne.decode(b)):[]}}}case"nevent":{let h=Ge(r);if(!((i=h[0])!=null&&i[0]))throw new Error("missing TLV 0 for nevent");if(h[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(h[2]&&h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(h[3]&&h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:D(h[0][0]),relays:h[1]?h[1].map(b=>ne.decode(b)):[],author:(s=h[2])!=null&&s[0]?D(h[2][0]):void 0,kind:(c=h[3])!=null&&c[0]?parseInt(D(h[3][0]),16):void 0}}}case"naddr":{let h=Ge(r);if(!((a=h[0])!=null&&a[0]))throw new Error("missing TLV 0 for naddr");if(!((f=h[2])!=null&&f[0]))throw new Error("missing TLV 2 for naddr");if(h[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((u=h[3])!=null&&u[0]))throw new Error("missing TLV 3 for naddr");if(h[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ne.decode(h[0][0]),pubkey:D(h[2][0]),kind:parseInt(D(h[3][0]),16),relays:h[1]?h[1].map(b=>ne.decode(b)):[]}}}case"nrelay":{let h=Ge(r);if(!((l=h[0])!=null&&l[0]))throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:ne.decode(h[0][0])}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:D(r)};default:throw new Error(`unknown prefix ${t}`)}}function Ge(e){let t={},n=e;for(;n.length>0;){let r=n[0],o=n[1],i=n.slice(2,2+o);if(n=n.slice(2+o),i.length<o)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(i)}return t}function Sa(e){return dt("nsec",e)}function Ba(e){return dt("npub",He(e))}function Ia(e){return dt("note",He(e))}function Ze(e,t){let n=Oe.toWords(t);return Oe.encode(e,n,on)}function dt(e,t){return Ze(e,t)}function Na(e){let t=ht({0:[He(e.pubkey)],1:(e.relays||[]).map(n=>X.encode(n))});return Ze("nprofile",t)}function _a(e){let t;e.kind!==void 0&&(t=Aa(e.kind));let n=ht({0:[He(e.id)],1:(e.relays||[]).map(r=>X.encode(r)),2:e.author?[He(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return Ze("nevent",n)}function La(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=ht({0:[X.encode(e.identifier)],1:(e.relays||[]).map(r=>X.encode(r)),2:[He(e.pubkey)],3:[new Uint8Array(t)]});return Ze("naddr",n)}function $a(e){let t=ht({0:[X.encode(e)]});return Ze("nrelay",t)}function ht(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(o=>{let i=new Uint8Array(o.length+2);i.set([parseInt(n)],0),i.set([o.length],1),i.set(o,2),t.push(i)})}),st(...t)}var sn={};q(sn,{decrypt:()=>Ua,encrypt:()=>Ur});async function Ur(e,t,n){const r=e instanceof Uint8Array?D(e):e,o=Pe.getSharedSecret(r,"02"+t),i=Tr(o);let s=Uint8Array.from(er(16)),c=X.encode(n),a=lr(i,s).encrypt(c),f=ae.encode(new Uint8Array(a)),u=ae.encode(new Uint8Array(s.buffer));return`${f}?iv=${u}`}async function Ua(e,t,n){const r=e instanceof Uint8Array?D(e):e;let[o,i]=n.split("?iv="),s=Pe.getSharedSecret(r,"02"+t),c=Tr(s),a=ae.decode(i),f=ae.decode(o),u=lr(c,a).decrypt(f);return ne.decode(u)}function Tr(e){return e.slice(1,33)}var Ta={};q(Ta,{NIP05_REGEX:()=>kr,isValid:()=>Ca,queryProfile:()=>Rr,searchDomain:()=>Ra,useFetchImplementation:()=>ka});var kr=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,gt;try{gt=fetch}catch{}function ka(e){gt=e}async function Ra(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`;return(await(await gt(n,{redirect:"error"})).json()).names}catch{return{}}}async function Rr(e){var i;const t=e.match(kr);if(!t)return null;const[n,r="_",o]=t;try{const s=`https://${o}/.well-known/nostr.json?name=${r}`,c=await(await gt(s,{redirect:"error"})).json();let a=c.names[r];return a?{pubkey:a,relays:(i=c.relays)==null?void 0:i[a]}:null}catch{return null}}async function Ca(e,t){let n=await Rr(t);return n?n.pubkey===e:!1}var Ha={};q(Ha,{parse:()=>Oa});function Oa(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of e.tags)r[0]==="e"&&r[1]&&n.push(r),r[0]==="p"&&r[1]&&t.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let r=0;r<n.length;r++){const o=n[r],[i,s,c,a]=o,f={id:s,relays:c?[c]:[]},u=r===0,l=r===n.length-1;if(a==="root"){t.root=f;continue}if(a==="reply"){t.reply=f;continue}if(a==="mention"){t.mentions.push(f);continue}if(u){t.root=f;continue}if(l){t.reply=f;continue}t.mentions.push(f)}return t}var Pa={};q(Pa,{fetchRelayInformation:()=>Ka,useFetchImplementation:()=>Ma});var Cr;try{Cr=fetch}catch{}function Ma(e){Cr=e}async function Ka(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var qa={};q(qa,{getPow:()=>Hr,minePow:()=>Da});function Hr(e){let t=0;for(let n=0;n<e.length;n++){const r=parseInt(e[n],16);if(r===0)t+=4;else{t+=Math.clz32(r)-28;break}}return t}function Da(e,t){let n=0;const r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){const i=Math.floor(new Date().getTime()/1e3);if(i!==r.created_at&&(n=0,r.created_at=i),o[1]=(++n).toString(),r.id=Ye(r),Hr(r.id)>=t)break}return r}var ja={};q(ja,{finishRepostEvent:()=>za,getRepostedEvent:()=>Va,getRepostedEventPointer:()=>Or});function za(e,t,n,r){return me({kind:en,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:e.content===""?"":JSON.stringify(t),created_at:e.created_at},r)}function Or(e){if(e.kind!==en)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function Va(e,{skipVerification:t}={}){const n=Or(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!Qt(r)))return r}var Za={};q(Za,{NOSTR_URI_REGEX:()=>pt,parse:()=>Wa,test:()=>Fa});var pt=new RegExp(`nostr:(${$r.source})`);function Fa(e){return typeof e=="string"&&new RegExp(`^${pt.source}$`).test(e)}function Wa(e){const t=e.match(new RegExp(`^${pt.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:ut(t[1])}}var Ga={};q(Ga,{finishReactionEvent:()=>Ya,getReactedEventPointer:()=>Ja});function Ya(e,t,n){const r=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return me({...e,kind:tn,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Ja(e){if(e.kind!==tn)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Xa={};q(Xa,{matchAll:()=>Qa,regex:()=>an,replaceAll:()=>ec});var an=()=>new RegExp(`\\b${pt.source}\\b`,"g");function*Qa(e){const t=e.matchAll(an());for(const n of t)try{const[r,o]=n;yield{uri:r,value:o,decoded:ut(o),start:n.index,end:n.index+r.length}}catch{}}function ec(e,t){return e.replaceAll(an(),(n,r)=>t({uri:n,value:r,decoded:ut(r)}))}var tc={};q(tc,{channelCreateEvent:()=>nc,channelHideMessageEvent:()=>ic,channelMessageEvent:()=>oc,channelMetadataEvent:()=>rc,channelMuteUserEvent:()=>sc});var nc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return me({kind:vr,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},rc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return me({kind:Ar,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},oc=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),me({kind:Sr,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},ic=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return me({kind:Br,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},sc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return me({kind:Ir,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},ac={};q(ac,{EMOJI_SHORTCODE_REGEX:()=>Pr,matchAll:()=>cc,regex:()=>cn,replaceAll:()=>fc});var Pr=/:(\w+):/,cn=()=>new RegExp(`\\B${Pr.source}\\B`,"g");function*cc(e){const t=e.matchAll(cn());for(const n of t)try{const[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function fc(e,t){return e.replaceAll(cn(),(n,r)=>t({shortcode:n,name:r}))}var lc={};q(lc,{useFetchImplementation:()=>uc,validateGithub:()=>dc});var fn;try{fn=fetch}catch{}function uc(e){fn=e}async function dc(e,t,n){try{return await(await fn(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var ln={};q(ln,{decrypt:()=>Vr,encrypt:()=>zr,getConversationKey:()=>qr,v2:()=>wc});var Mr=1,Kr=65535;function qr(e,t){const n=Pe.getSharedSecret(e,"02"+t).subarray(1,33);return zi(Me,n,"nip44-v2")}function Dr(e,t){const n=Vi(Me,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function un(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function hc(e){if(!Number.isSafeInteger(e)||e<Mr||e>Kr)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function gc(e){const t=X.encode(e),n=t.length,r=hc(n),o=new Uint8Array(un(n)-n);return st(r,t,o)}function pc(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Mr||t>Kr||n.length!==t||e.length!==2+un(t))throw new Error("invalid padding");return ne.decode(n)}function jr(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=st(n,t);return ft(Me,e,r)}function yc(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=ae.decode(e)}catch(i){throw new Error("invalid base64: "+i.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function zr(e,t,n=er(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:i}=Dr(t,n),s=gc(e),c=gr(r,o,s),a=jr(i,c,n);return ae.encode(st(new Uint8Array([2]),n,c,a))}function Vr(e,t){const{nonce:n,ciphertext:r,mac:o}=yc(e),{chacha_key:i,chacha_nonce:s,hmac_key:c}=Dr(t,n),a=jr(c,r,n);if(!Bi(a,o))throw new Error("invalid MAC");const f=gr(i,s,r);return pc(f)}var wc={utils:{getConversationKey:qr,calcPaddedLen:un},encrypt:zr,decrypt:Vr},bc={};q(bc,{makeNwcRequestEvent:()=>xc,parseConnectionString:()=>Ec});function Ec(e){const{pathname:t,searchParams:n}=new URL(e),r=t,o=n.get("relay"),i=n.get("secret");if(!r||!o||!i)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:i}}async function xc(e,t,n){const o=await Ur(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),i={kind:_r,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return me(i,t)}var mc={};q(mc,{getZapEndpoint:()=>Ac,makeZapReceipt:()=>Ic,makeZapRequest:()=>Sc,useFetchImplementation:()=>vc,validateZapRequest:()=>Bc});var dn;try{dn=fetch}catch{}function vc(e){dn=e}async function Ac(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:s}=Oe.decode(n,1e3),c=Oe.fromWords(s);t=ne.decode(c)}else if(r){let[s,c]=r.split("@");t=new URL(`/.well-known/lnurlp/${s}`,`https://${c}`).toString()}else return null;let i=await(await dn(t)).json();if(i.allowsNostr&&i.nostrPubkey)return i.callback}catch{}return null}function Sc({profile:e,event:t,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let i={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&i.tags.push(["e",t]),i}function Bc(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!yr(t))return"Zap request is not a valid Nostr event.";if(!Qt(t))return"Invalid signature on zap request.";let n=t.tags.find(([i,s])=>i==="p"&&s);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([i,s])=>i==="e"&&s);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([i,s])=>i==="relays"&&s)?null:"Zap request doesn't have a 'relays' tag."}function Ic({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let o=JSON.parse(e),i=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),s={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["P",o.pubkey],["bolt11",n],["description",e]]};return t&&s.tags.push(["preimage",t]),s}var Nc={};q(Nc,{getToken:()=>_c,hashPayload:()=>hn,unpackEventFromToken:()=>Fr,validateEvent:()=>Qr,validateEventKind:()=>Gr,validateEventMethodTag:()=>Jr,validateEventPayloadTag:()=>Xr,validateEventTimestamp:()=>Wr,validateEventUrlTag:()=>Yr,validateToken:()=>Lc});var Zr="Nostr ";async function _c(e,t,n,r=!1,o){const i={kind:nn,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&i.tags.push(["payload",hn(o)]);const s=await n(i);return(r?Zr:"")+ae.encode(X.encode(JSON.stringify(s)))}async function Lc(e,t,n){const r=await Fr(e).catch(i=>{throw i});return await Qr(r,t,n).catch(i=>{throw i})}async function Fr(e){if(!e)throw new Error("Missing token");e=e.replace(Zr,"");const t=ne.decode(ae.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function Wr(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function Gr(e){return e.kind===nn}function Yr(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function Jr(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function hn(e){const t=Me(X.encode(JSON.stringify(e)));return D(t)}function Xr(e,t){const n=e.tags.find(o=>o[0]==="payload");if(!n)return!1;const r=hn(t);return n.length>0&&n[1]===r}async function Qr(e,t,n,r){if(!Qt(e))throw new Error("Invalid nostr event, signature invalid");if(!Gr(e))throw new Error("Invalid nostr event, kind invalid");if(!Wr(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Yr(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!Jr(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!Xr(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}console.log("Nostr Key Signer: Background script starting");const Kt="7e7e9c42a91bfef19fa929e5fda1b72e0ebc1a4c1141673e2794234d86addf4e",Fe="67dea2ed018072d675f5415ecfaed7d2597555e202d85b3d65ea4e58d2d92ffa";async function $c(e){console.log("Nostr Key Signer: signEvent called with",e);try{if(!e)throw new Error("Event object is undefined");e.kind=e.kind||1,e.created_at=e.created_at||Math.floor(Date.now()/1e3),e.tags=e.tags||[],e.content=e.content||"",e.pubkey=Kt;const t=hi(e,Fe);return console.log("Nostr Key Signer: Event signed",t),t}catch(t){throw console.error("Nostr Key Signer: Error in signEvent function",t),t}}async function Uc(e,t){console.log("Nostr Key Signer: encryptMessageNip04 called");try{const n=await sn.encrypt(Fe,e,t);return console.log("Nostr Key Signer: Message encrypted (NIP-04)"),n}catch(n){throw console.error("Nostr Key Signer: Error in encryptMessageNip04 function",n),n}}async function Tc(e,t){console.log("Nostr Key Signer: decryptMessageNip04 called");try{const n=await sn.decrypt(Fe,e,t);return console.log("Nostr Key Signer: Message decrypted (NIP-04)"),n}catch(n){throw console.error("Nostr Key Signer: Error in decryptMessageNip04 function",n),n}}async function kc(e,t){console.log("Nostr Key Signer: encryptMessageNip44 called");try{const n=await ln.encrypt(Fe,e,t);return console.log("Nostr Key Signer: Message encrypted (NIP-44)"),n}catch(n){throw console.error("Nostr Key Signer: Error in encryptMessageNip44 function",n),n}}async function Rc(e,t){console.log("Nostr Key Signer: decryptMessageNip44 called");try{const n=await ln.decrypt(Fe,e,t);return console.log("Nostr Key Signer: Message decrypted (NIP-44)"),n}catch(n){throw console.error("Nostr Key Signer: Error in decryptMessageNip44 function",n),n}}chrome.runtime.onMessage.addListener((e,t,n)=>{if(console.log("Nostr Key Signer: Received message",e),e.type==="getPublicKey")return console.log("Nostr Key Signer: Returning public key",Kt),n(Kt),!0;if(e.type==="signEvent")return console.log("Nostr Key Signer: Signing event",e.event),$c(e.event).then(r=>{console.log("Nostr Key Signer: Event signed successfully",r),n(r)}).catch(r=>{console.error("Nostr Key Signer: Error signing event",r),n({error:r.message})}),!0;if(e.type==="encryptMessageNip04")return console.log("Nostr Key Signer: Encrypting message (NIP-04)"),Uc(e.recipientPubkey,e.content).then(r=>{console.log("Nostr Key Signer: Message encrypted successfully (NIP-04)"),n(r)}).catch(r=>{console.error("Nostr Key Signer: Error encrypting message (NIP-04)",r),n({error:r.message})}),!0;if(e.type==="decryptMessageNip04")return console.log("Nostr Key Signer: Decrypting message (NIP-04)"),Tc(e.senderPubkey,e.encryptedContent).then(r=>{console.log("Nostr Key Signer: Message decrypted successfully (NIP-04)"),n(r)}).catch(r=>{console.error("Nostr Key Signer: Error decrypting message (NIP-04)",r),n({error:r.message})}),!0;if(e.type==="encryptMessageNip44")return console.log("Nostr Key Signer: Encrypting message (NIP-44)"),kc(e.recipientPubkey,e.content).then(r=>{console.log("Nostr Key Signer: Message encrypted successfully (NIP-44)"),n(r)}).catch(r=>{console.error("Nostr Key Signer: Error encrypting message (NIP-44)",r),n({error:r.message})}),!0;if(e.type==="decryptMessageNip44")return console.log("Nostr Key Signer: Decrypting message (NIP-44)"),Rc(e.senderPubkey,e.encryptedContent).then(r=>{console.log("Nostr Key Signer: Message decrypted successfully (NIP-44)"),n(r)}).catch(r=>{console.error("Nostr Key Signer: Error decrypting message (NIP-44)",r),n({error:r.message})}),!0});console.log("Nostr Key Signer: Background script loaded");
